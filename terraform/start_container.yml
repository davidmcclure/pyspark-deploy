---

# TODO: Only restart if image has changed?
- name: Start container
  docker_container:
    image: '{{ docker_image }}'
    name: '{{ name }}'
    command: '{{ command }}'
    volumes:
      - '{{ config_dir }}:{{ spark_home }}/conf'
      - '{{ data_dir }}:{{ data_dir }}'
    env:
      AWS_ACCESS_KEY_ID: '{{ aws_access_key_id }}'
      AWS_SECRET_ACCESS_KEY: '{{ aws_secret_access_key }}'
      SPARK_ENV: prod
    runtime: '{{ runtime|default("") }}'
    state: started
    network_mode: host
    pull: true
    timeout: 300
